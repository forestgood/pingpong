/**
 * DropKick
 *
 * Highly customizable <select> lists
 * https://github.com/robdel12/DropKick
 *
 * &copy; 2011 Jamie Lottering <http://github.com/JamieLottering>
 *                        <http://twitter.com/JamieLottering>
 *
 * History:
 * 2013-02: live > on (joeblynch)
 * 2013-06: + trigger "change" at update (so one can detect the change) (joeri210)
 *          + method: "reload" to rebuild the pulldown (when dynamic populated) (joeri210)
 */
(function(a,b,c){function n(a,b){var c=a.keyCode,d=b.data("dropkick"),e=b.find(".dk_options"),f=b.hasClass("dk_open"),g=b.find(".dk_option_current"),h=e.find("li").first(),j=e.find("li").last(),k,l;switch(c){case i.enter:f?(o(g.find("a"),b),r(b)):s(b),a.preventDefault();break;case i.tab:f&&(o(g.find("a"),b),r(b));break;case i.up:l=g.prev("li"),f?l.length?p(l,b):p(j,b):s(b),a.preventDefault();break;case i.down:f?(k=g.next("li").first(),k.length?p(k,b):p(h,b)):s(b),a.preventDefault();break;default:}}function o(a,b,c){var d,e,f;d=a.attr("data-dk-dropdown-value"),e=a.text(),f=b.data("dropkick"),$select=f.$select,$select.val(d).trigger("change"),b.find(".dk_label").text(e),c=c||!1,f.settings.change&&!c&&f.settings.change.call($select,d,e)}function p(a,b){b.find(".dk_option_current").removeClass("dk_option_current"),a.addClass("dk_option_current"),q(b,a)}function q(a,b){var c=b.prevAll("li").outerHeight()*b.prevAll("li").length;a.find(".dk_options_inner").animate({scrollTop:c+"px"},0)}function r(a){a.removeClass("dk_open")}function s(a){var b=a.data("dropkick");a.find(".dk_options").css({top:a.find(".dk_toggle").outerHeight()-1}),a.toggleClass("dk_open")}function t(b,c){var d=b,e=[],f;d=d.replace("{{ id }}",c.id),d=d.replace("{{ label }}",c.label),d=d.replace("{{ tabindex }}",c.tabindex);if(c.options&&c.options.length)for(var g=0,h=c.options.length;g<h;g++){var i=a(c.options[g]),j="dk_option_current",l=k;l=l.replace("{{ value }}",i.val()),l=l.replace("{{ current }}",u(i.val())===c.value?j:""),l=l.replace("{{ text }}",i.text()),e[e.length]=l}return f=a(d),f.find(".dk_options_inner").html(e.join("")),f}function u(b){return a.trim(b).length>0?b:!1}var d=navigator.userAgent.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),e=!!d,f=e&&parseFloat(d[1])<7;f||(c.documentElement.className=c.documentElement.className+" dk_fouc");var g={},h=[],i={left:37,up:38,right:39,down:40,enter:13,tab:9},j=['<div class="dk_container" id="dk_container_{{ id }}" tabindex="{{ tabindex }}">','<a class="dk_toggle">','<span class="dk_label">{{ label }}</span>',"</a>",'<div class="dk_options">','<ul class="dk_options_inner">',"</ul>","</div>","</div>"].join(""),k='<li class="{{ current }}"><a data-dk-dropdown-value="{{ value }}">{{ text }}</a></li>',l={startSpeed:1e3,theme:!1,change:!1},m=!1;g.init=function(b){return b=a.extend({},l,b),this.each(function(){var c=a(this),d=c.find(":selected").first(),e=c.find("option"),f=c.data("dropkick")||{},g=c.attr("id")||c.attr("name"),i=b.width||c.outerWidth(),k=c.attr("tabindex")?c.attr("tabindex"):"",l=!1,m;if(f.id)return c;f.settings=b,f.tabindex=k,f.id=g,f.$original=d,f.$select=c,f.value=u(c.val())||u(d.attr("value")),f.label=d.text(),f.options=e,l=t(j,f),l.find(".dk_toggle").css({width:i+"px"}),c.before(l),l=a("#dk_container_"+g).fadeIn(b.startSpeed),m=b.theme?b.theme:"default",l.addClass("dk_theme_"+m),f.theme=m,f.$dk=l,c.data("dropkick",f),l.data("dropkick",f),h[h.length]=c,l.bind("focus.dropkick",function(a){l.addClass("dk_focus")}).bind("blur.dropkick",function(a){l.removeClass("dk_open dk_focus")}),setTimeout(function(){c.hide()},0)})},g.theme=function(b){var c=a(this),d=c.data("dropkick"),e=d.$dk,f="dk_theme_"+d.theme;e.removeClass(f).addClass("dk_theme_"+b),d.theme=b},g.reset=function(){for(var a=0,b=h.length;a<b;a++){var c=h[a].data("dropkick"),d=c.$dk,e=d.find("li").first();d.find(".dk_label").text(c.label),d.find(".dk_options_inner").animate({scrollTop:0},0),p(e,d),o(e,d,!0)}},g.reload=function(){var b=a(this),c=b.data("dropkick");b.removeData("dropkick"),a("#dk_container_"+c.id).remove(),b.dropkick(c.settings)},a.fn.dropkick=function(a){if(!f){if(g[a])return g[a].apply(this,Array.prototype.slice.call(arguments,1));if(typeof a=="object"||!a)return g.init.apply(this,arguments)}},a(function(){a(c).on("click",".dk_toggle",function(c){var d=a(this).parents(".dk_container").first();return s(d),"ontouchstart"in b&&(d.addClass("dk_touch"),d.find(".dk_options_inner").addClass("scrollable vertical")),c.preventDefault(),!1}),a(c).on(e?"mousedown":"click",".dk_options a",function(b){var c=a(this),d=c.parents(".dk_container").first(),e=d.data("dropkick");return r(d),o(c,d),p(c.parent(),d),b.preventDefault(),!1}),a(c).bind("keydown.dk_nav",function(b){var c=a(".dk_container.dk_open"),d=a(".dk_container.dk_focus"),e=null;c.length?e=c:d.length&&!c.length&&(e=d),e&&n(b,e)}),a(c).on("click",null,function(b){a(b.target).closest(".dk_container").length==0&&r(a(".dk_toggle").parents(".dk_container").first())})})})(jQuery,window,document);